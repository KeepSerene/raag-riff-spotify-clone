<!-- prettier-ignore -->
<%
const { 
   id,
   type: playlistType,
   name: playlistName,
   description,
   followers: { total: totalFollowers },
   external_urls: { spotify: spotifyUrl },
   images: playlistImages,
   owner: { display_name: ownerName },
   tracks: { total: totalTracks, items: playlistTracks },
   uri: playlistUri,
} = locals.playlistInfo;
const {
  width: playlistBannerWidth = 300,
  height: playlistBannerHeight = 300,
  url: playlistBannerSrc = "/images/playlist-banner.png"
} = playlistImages.at(0) ?? {};
%>

<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include("../layouts/head.ejs", { title: `${playlistName} â€” ${ownerName}
    | RaagRiff` }) %>

    <link rel="stylesheet" href="/css/info-page.css" />

    <style>
      .page::before {
        background-image: url("<%= playlistBannerSrc %>");
      }
    </style>
  </head>

  <body>
    <main class="page custom-scrollbar" data-page>
      <!-- Topbar -->
      <%- include("../partials/top-bar.ejs", locals.currentUserProfile) %>

      <article class="main">
        <!-- Playlist info -->
        <header class="info-header">
          <figure class="figure-img info-banner">
            <img
              src="<%= playlistBannerSrc %>"
              alt="<%= playlistName %> banner"
              width="<%= playlistBannerWidth %>"
              height="<%= playlistBannerHeight %>"
              loading="lazy"
              class="cover-img"
              data-lazy-loaded
            />
          </figure>

          <div class="info-content">
            <p class="label-large info-subtitle"><%= playlistType %></p>

            <h2 class="headline-large info-title"><%= playlistName %></h2>

            <p class="info-text body-medium"><%- description %></p>

            <div class="info-text has-separator">
              <p class="label-large">By <%= ownerName %></p>
              <span class="separator"></span>

              <% if (totalFollowers > 1) { %>
              <p class="label-large">
                <%- totalFollowers.toLocaleString("en-US") %> Followers
              </p>
              <% } else { %>
              <p class="label-large">
                <%- totalFollowers.toLocaleString("en-US") %> Follower
              </p>
              <% } %>
              <span class="separator"></span>

              <% if (totalTracks > 1) { %>
              <p class="label-large">
                <%- totalTracks.toLocaleString("en-US") %> Tracks
              </p>
              <% } else { %>
              <p class="label-large">
                <%- totalTracks.toLocaleString("en-US") %> Track
              </p>
              <% } %>
            </div>

            <div class="info-actions">
              <%- include("../partials/play-btn.ejs", { variant: "filled",
              dataAttr: `data-uri=${playlistUri}` }) %>

              <a
                href="<%= spotifyUrl %>"
                target="_blank"
                class="btn btn-outline has-icon"
                data-ripple
              >
                <img
                  src="/images/spotify-primary.svg"
                  alt="Spotify logo"
                  width="18"
                  height="18"
                />
                <span class="label-large">Listen on Spotify</span>
                <div class="state-layer"></div>
              </a>
            </div>
          </div>
        </header>

        <div class="divider"></div>

        <!-- Playlist tracks -->
        <div class="list-container">
          <header class="list-header" data-list-header>
            <div aria-label="Serial number" class="sr-no-col body-large">#</div>

            <div class="col body-large">Track</div>

            <div class="col album-col body-large">Album</div>

            <div class="duration-col">
              <span aria-label="Duration" class="material-symbols-rounded"
                >schedule</span
              >
            </div>
          </header>

          <div class="list">
            <!-- prettier-ignore -->
            <% playlistTracks.filter(item => item !== null).forEach((item, index) => { %>
              <%
                const {
                    id,
                    name: title,
                    album: { name: albumName, images },
                    artists,
                    duration_ms,
                    uri: trackUri,
                } = item.track;
                const text = artists.map(({ name }) => name).join(", ");
                index++;
              %>

              <%- include("../partials/list-item.ejs", {
                id,
                title,
                albumName,
                images,
                text,
                trackSrNo: index,
                duration_ms,
                trackUri,
              }) %>
            <% }) %>
          </div>
        </div>
      </article>

      <!-- Music player small -->
      <%- include("../partials/player-sm.ejs") %>

      <!-- Music player large (modal view) -->
      <%- include("../partials/player-lg.ejs") %>

      <!-- Footer -->
      <%- include("../layouts/footer.ejs") %>

      <!-- Bottom navigation -->
      <%- include("../partials/bottom-nav.ejs") %>
    </main>

    <!-- Recently played tracks sidebar -->
    <%- include("../layouts/recent-tracks-sidebar.ejs", { recentTracks:
    locals.recentlyPlayedTracks }) %>
  </body>
</html>
