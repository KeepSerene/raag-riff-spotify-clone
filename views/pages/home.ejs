<!-- prettier-ignore -->
<% 
  const { artists: recommendedArtists } = locals.recommendedArtistsInfo;
  const { items: newReleasesCurrentPage, next: newReleasesNextPage } = locals.newReleases;
  const { playlists: { items: playlistsCurrentPage, next: playlistsNextPage}} = locals.featuredPlaylistsInfo; 
  const { playlists: { items: catPlaylistsCurrentPage, next: catPlaylistsNextPage}} = locals.categoryPlaylistsInfo; 
%>

<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include("../layouts/head.ejs", { title: "Home | RaagRiff" }) %>
  </head>

  <body>
    <main class="page custom-scrollbar" data-page>
      <!-- Topbar -->
      <%- include("../partials/top-bar.ejs", locals.currentUserProfile) %>

      <!-- Main content -->
      <article class="main-content" data-main-content>
        <!-- Recommended albums -->
        <% if (locals.recommendedAlbums.length > 0) { %>
        <section class="section new-release">
          <div class="title-wrapper">
            <h2 class="title-large section-title">Recommended for you</h2>
          </div>

          <div class="slider">
            <div class="slider-inner">
              <!-- prettier-ignore -->
              <% locals.recommendedAlbums.filter(item => item !== null).forEach(({ id, name: title, artists, images, uri }) => { %>
                <%
                  const text = artists.map(({ name }) => name).join(", "); 
                  const img300x300 = images.find(img => img.width === 300);
                %>

                <%-
                  include("../partials/card.ejs", {
                    type: 'album',
                    title,
                    text,
                    uri,
                    link: `/albums/${id}`,
                    image: img300x300,
                  })
                %>
              <% }) %>
            </div>
          </div>
        </section>
        <% } %>

        <!-- Recommended artists -->
        <% if (recommendedArtists.length > 0) { %>
        <section class="section new-release">
          <div class="title-wrapper">
            <h2 class="title-large section-title">Artists for you</h2>
          </div>

          <div class="slider">
            <div class="slider-inner">
              <!-- prettier-ignore -->
              <% recommendedArtists.filter(item => item !== null).forEach(({ name: title, id, type, uri, images }) => { %>
                <% const [image] = images || [] %>

                <%- 
                  include("../partials/card.ejs", {
                    type,
                    title,
                    uri,
                    image,
                    variant: "artist-card",
                    text: type,
                    link: `artists/${id}`
                  }) 
                %>
              <% }) %>
            </div>
          </div>
        </section>
        <% } %>

        <!-- New releases (albums) -->
        <section class="section new-release">
          <div class="title-wrapper">
            <h2 class="title-large section-title">New Releases</h2>

            <% if (newReleasesNextPage) { %>
            <a href="/albums" class="btn btn-link" data-ripple>
              <span class="label-large">See all</span>

              <div class="state-layer"></div>
            </a>
            <% } %>
          </div>

          <div class="slider">
            <div class="slider-inner">
              <!-- prettier-ignore -->
              <% newReleasesCurrentPage.filter(item => item !== null).forEach(({ id, name: title, images, artists, uri }) => { %>
                <%
                  const text = artists.map(({name}) => name).join(", ");
                  const img300x300 = images.find(img => img.width === 300); 
                %>

                <%-
                  include("../partials/card.ejs", {
                    type: "album",
                    title,
                    text,
                    image: img300x300,
                    link: `/albums/${id}`,
                    uri
                  }) 
                %>
              <% }) %>
            </div>
          </div>
        </section>

        <!-- Featured playlists -->
        <section class="section new-release">
          <div class="title-wrapper">
            <h2 class="title-large section-title">Featured Playlists</h2>

            <% if (playlistsNextPage) { %>
            <a href="/playlists" class="btn btn-link" data-ripple>
              <span class="label-large">See all</span>

              <div class="state-layer"></div>
            </a>
            <% } %>
          </div>

          <div class="slider">
            <div class="slider-inner">
              <!-- prettier-ignore -->
              <% playlistsCurrentPage.filter(item => item !== null).forEach(({ id, name: title, description, images, uri, owner }) => { %>
                <%
                  const text = description || owner?.display_name || "Spotify";
                  const [image] = images || [];
                %>

                <%-
                  include("../partials/card.ejs", {
                    type: "playlist",
                    title,
                    text,
                    uri,
                    image,
                    link: `/playlists/${id}`
                  })
                %>
              <% }) %>
            </div>
          </div>
        </section>

        <!-- Category playlists -->
        <section class="section new-release">
          <div class="title-wrapper">
            <h2 class="title-large section-title">Top Playlists</h2>

            <% if (catPlaylistsNextPage) { %>
            <a href="/explore/toplists" class="btn btn-link" data-ripple>
              <span class="label-large">See all</span>

              <div class="state-layer"></div>
            </a>
            <% } %>
          </div>

          <div class="slider">
            <div class="slider-inner">
              <!-- prettier-ignore -->
              <% catPlaylistsCurrentPage.filter(item => item !== null).forEach(({ id, name: title, description, images, uri, owner }) => { %>
                <%
                  const text = description || owner?.display_name || "Spotify";
                  const [image] = images || [];
                %>

                <%-
                  include("../partials/card.ejs", {
                    type: "playlist",
                    title,
                    text,
                    uri,
                    image,
                    link: `/playlists/${id}`
                  })
                %>
              <% }) %>
            </div>
          </div>
        </section>
      </article>

      <!-- Music player small -->
      <%- include("../partials/player-sm.ejs") %>

      <!-- Music player large (modal view) -->
      <%- include("../partials/player-lg.ejs") %>

      <!-- Footer -->
      <%- include("../layouts/footer.ejs") %>

      <!-- Bottom navigation -->
      <%- include("../partials/bottom-nav.ejs", { currentRoute: "/" }) %>
    </main>

    <!-- Recently played tracks sidebar -->
    <%- include("../layouts/recent-tracks-sidebar.ejs", { recentTracks:
    locals.recentlyPlayedTracks }) %>
  </body>
</html>
